<div id="explore-page" infinite-scroll="addMoreItems()" infinite-scroll-distance="1">
  <div id="explore-left-panel">
    <!-- Left hand side panel for a list of projects-->
    <div id="project-list">

      <input type="hidden" id="activeUserId" value="{{activeUser.Id}}"/>
      <input type="hidden" id="projectTranslation" value="{{'PROJECT' | translate}}"/>
      <input type="hidden" id="searchProjectsTranslation" value="{{'SEARCH_PROJECTS' | translate}}"/>

      <template id="projectsList" is="dom-bind">

        <iron-ajax
          url="https://requirements-bazaar.org/bazaar/projects/"
          last-response="{{data}}"
          params='{"page":"0", "per_page":"150"}'
          auto></iron-ajax>

      <!-- Projects relevant to the user -->
      <div ng-show="activeUser">
        <div class="flex-space-between explore-own-projects">
          <h1 ng-bind="'YOUR_PROJECTS'|translate"></h1>
          <paper-button id="explore-create-project-button" ng-click="startCreationProj()">{{projectTranslation}}</paper-button>
        </div>

        <template is="dom-repeat" items="{{data}}" filter="privateSearchFilter">

          <paper-card heading="[[item.name]]" on-click="goToProject">
            <div class="card-content">[[item.description]]</div>
          </paper-card>
        </template>

        <!--
        <req-baz-project ng-repeat="project in projects | filter:{ leaderId: activeUser.Id }" name={{project.name}} desc={{project.description}} ng-click="goToProject(project.id,project.defaultComponentId)"></req-baz-project>
        -->
      </div>

      <!-- Public projects, always shown and infinite scroll -->
      <div class="flex-space-between explore-public-projects">
        <h1 ng-bind="'PUBLIC_PROJECTS'|translate"></h1>
        <!--
        <div id="explore-search-projects" class="group">
          <input placeholder={{'SEARCH_PROJECTS'|translate}} type="text" ng-model="filterReq.$">
          <span class="highlight"></span>
          <span class="bar"></span>
        </div>
        -->
      </div>


        <paper-input label$="[[searchProjectsTranslation]]" value="{{publicFilterVal}}"></paper-input>

        <template is="dom-repeat" items="{{data}}" filter="{{publicSearchFilter(publicFilterVal)}}">

          <paper-card heading="[[item.name]]" on-click="goToProject">
            <div class="card-content">[[item.description]]</div>
          </paper-card>
        </template>

        <script>

          projectsList.projectTranslation = document.getElementById("projectTranslation").value;
          projectsList.searchProjectsTranslation = document.getElementById("searchProjectsTranslation").value;

          projectsList.goToProject = function(e) {
            var model = e.model;
            window.location = '#/project/' + model.item.id + '/component/' + model.item.defaultComponentId;
          };

          projectsList.privateSearchFilter = function(item) {
            var activeUserId = document.getElementById("activeUserId").value;
            return item.leaderId == activeUserId;
          }

          // thanks goes to http://jcrowther.io/2015/06/09/polymer-dom-repeat-filtering-and-sorting/ for the great help
          projectsList.publicSearchFilter = function(val) {
            return function(item) {
              if (!val) return true;
              return (item.name && ~item.name.toLowerCase().indexOf(val.toLowerCase()));
            }
          }

        </script>

      </template>

      <!--
            <req-baz-project ng-repeat="project in projects | filter:filterReq:strict | limitTo : limit track by project.id" name={{project.name}} desc={{project.description}} ng-click="goToProject(project.id,project.defaultComponentId)"></req-baz-project>
-->

    </div>

    <!-- Right hand side panel -->
    <div id="explore-recent" ng-show="activeUser">
      <paper-material elevation="1">
        <h4 ng-bind="'RECENT_ACTIVITY'|translate"></h4>
        <p ng-bind="'COMING_SOON'|translate"></p>
      </paper-material>
    </div>
  </div>

  <!--

  Create a new project , twice as one is for mobile and other for desktop

  -->
  <paper-dialog id="create-dialog-project" modal class="create-dialog">
    <div ng-controller="CreateProjectCtrl">
      <p ng-bind="'CREATE_PROJ' | translate"></p>
      <paper-input ng-model="name" label={{'TITLE'|translate}} maxlength="50" char-counter></paper-input>
      <paper-textarea  ng-model="desc" label={{'DESC'|translate}}></paper-textarea>

      <!--Confirm or cancel submit-->
      <div class="flex-space-between" style="flex-grow: 1; align-items: flex-end; padding-bottom: 32px;">
        <paper-button raised ng-click="submit()" ng-bind="'CREATE' | translate"></paper-button>
        <paper-button ng-click="clearSubmit()">
          <iron-icon icon="icons:clear"></iron-icon>
        </paper-button>
      </div>
    </div>
  </paper-dialog>

  <div id="explore-create-project-container" ng-show="showCreateProjDiv" ng-controller="CreateProjectCtrl">
    <p ng-bind="'CREATE_PROJ' | translate"></p>
    <paper-input ng-model="name" label={{'TITLE'|translate}} maxlength="50" char-counter></paper-input>
    <paper-textarea  ng-model="desc" label={{'DESC'|translate}}></paper-textarea>

    <!--Confirm or cancel submit-->
    <div class="flex-space-between">
      <paper-button raised ng-click="submit()" ng-bind="'CREATE' | translate"></paper-button>
      <paper-button ng-click="clearSubmit()">
        <iron-icon icon="icons:clear"></iron-icon>
      </paper-button>
    </div>
  </div>


</div>
