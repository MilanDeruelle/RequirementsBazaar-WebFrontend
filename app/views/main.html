<paper-drawer-panel>

  <!-- Left hand sidebar for component selection and project settings-->
  <div class="drawer-sidebar" drawer>

    <!-- Project name, settings -->
    <div id="main-project-settings" class="flex-space-between">
      <h4 ng-bind="activeProject.name" style="flex-grow: 1;"></h4>
      <div class="drop" ng-show="activeUser !== null" style="margin: auto">
        <iron-icon icon="icons:more-vert"></iron-icon>
        <ul>
          <li ng-click="editProject()" ng-bind="'SETTINGS'|translate"></li>
          <li ng-click="startCreationComp()" ng-bind="'COMPONENT'|translate"></li>
        </ul>
      </div>
    </div>

    <!-- List of components and filter -->
    <div class="group main-component-list">
      <input placeholder={{'FILTER_COMPONENTS'|translate}} type="text" ng-model="filterComp.name">
      <span class="highlight"></span>
      <span class="bar"></span>
    </div>
    <paper-button ng-repeat="component in components | filter:filterComp:strict | filter:{id:activeProject.defaultComponentId}" ng-click="selectComp(component)" ng-bind="component.name" noink class="text-087"></paper-button>
    <paper-button ng-repeat="component in components | filter:filterComp:strict | filter:{id:'!'+activeProject.defaultComponentId}" ng-click="selectComp(component)" ng-bind="component.name" noink class="text-087"></paper-button>
    <paper-button raised id="loadComponents" ng-show="reloadComponents" ng-click="selectProj(activeProject)" ng-bind="'RELOAD'|translate"></paper-button>
  </div>

  <!-- The main content panel -->
  <div class="drawer-main" main id="inf-scroll" infinite-scroll="addMoreItems()" infinite-scroll-distance="2">
    <div class="content">
      <!--Currently selected component-->
      <div id="current-component" class="current-component-width" ng-controller="ActiveCompCtrl">
        <paper-material elevation="1">
          <div class="flex-space-between" style="padding: 8px">
            <div class="text-087" style="flex-grow: 1;padding-right: 8px;">
              <div ng-show="!isDirty">
                <span ng-show="activeProject.defaultComponentId === activeComponent.id" ng-bind="'DEFAULT'|translate" class="small-grey-text"></span>
                <h2 ng-bind="activeComponent.name"></h2>
                <pre ng-bind="activeComponent.description"></pre>
              </div>
              <div ng-show="isDirty" class="text-087">
                <paper-input ng-model="dirtyComp.name" label={{'TITLE'|translate}} maxlength="50" char-counter></paper-input>
                <paper-textarea ng-model="dirtyComp.description" label={{'DESC'|translate}}></paper-textarea>
                <paper-spinner ng-show="mainCompSavingInprogress" active alt="saving in process"></paper-spinner>
                <paper-button raised ng-click="saveChanges()" ng-disabled="mainCompSavingInprogress" ng-bind="'SAVE'|translate"></paper-button>
                <paper-button raised ng-click="cancelChanges()" ng-disabled="mainCompSavingInprogress" ng-bind="'CANCEL'|translate"></paper-button>
              </div>
            </div>
            <div>
              <div id="comp-lead-container">
                <p ng-bind="'COMPONENT_LEAD' |translate" class="small-grey-text"></p>
                <div class="drop" ng-show="activeUser !== null">
                  <iron-icon icon="icons:more-vert"></iron-icon>
                  <ul>
                    <li ng-click="setDefaulComp()" ng-bind="'SET_DEFAULT_COMP'|translate"></li>
                    <li ng-show="false" ng-click="" ng-bind="'BECOME_LEAD_DEV'|translate"></li>
                    <li ng-click="startEdit()" ng-disabled="isDirtyReq" ng-bind="'EDIT_COMP'|translate"></li>
                    <li ng-click="confirmDelete()" ng-bind="'DELETE_COMP'|translate"></li>
                  </ul>
                </div>
              </div>
              <my-user src={{trustSrc(componentLeader.profileImage)}} size="30" name={{componentLeader.userName}} class="text-087"></my-user>
              <div id="show-realized">
                <span>{{'REALIZED_REQ' | translate}}</span>
                <paper-toggle-button ng-model="showRealized.value"></paper-toggle-button>
              </div>
              <div class="group">
                <input placeholder={{'SEARCH_REQUIREMENTS'|translate}} type="text" ng-model="filterReq.$">
                <span class="highlight"></span>
                <span class="bar"></span>
              </div>
            </div>
          </div>
        </paper-material>
      </div>

      <!--If there is a network problem loading the requirements then this button is shown-->
      <paper-button raised id="load-requirements" ng-show="reloadRequirements" ng-click="selectComp(activeComponent)" ng-bind="'RELOAD'|translate" class="text-087"></paper-button>


      <!-- List of requirements , WARNING, don't include any css classes to this div, causes bugs -->
      <div id="req-{{$index}}" ng-repeat="req in requirements | filter:isRealizedFilter |filter:filterReq:strict |  limitTo : limit track by req.id"
           ng-controller="RequirementCtrl"
           class="requirement-container"
           ng-style="{ 'margin-bottom': $last ? '128px' : '0px' }"
           style="margin-top: 10px;background-color: white;width: 100%;margin-left: auto;margin-right: auto;max-width: 1000px;">
        <!--Requirement header-->
        <paper-material elevation="1">
          <div class="requirement-header">
            <div ng-click="setSelectedReqId(req.id,$index)" class="requirement-header-title">
              <p ng-bind="req.title" class="ellipsis req-title text-087"></p>
              <time is="relative-time" datetime={{req.creation_time}} class="small-grey-text"></time>
              <span class="small-grey-text">{{' by ' + reqCreator}}</span>
            </div>
            <div ng-controller="VoteCtrl" class="vote-button-container">
              <paper-button style="min-width: 30px" ng-click="vote(req,false)">
                <iron-icon ng-show="req.userVoted === 'UP_VOTE'" icon="icons:star"></iron-icon>
                <iron-icon ng-show="req.userVoted !== 'UP_VOTE'" icon="icons:star-border"></iron-icon>
              </paper-button>
              <p ng-bind="req.upVotes" class="small-grey-text"></p>
            </div>
            <div class="drop">
              <iron-icon icon="icons:more-vert"></iron-icon>
              <ul>
                <li ng-click="showContrib(req,$index)" ng-show="!showContributors || !showRequirement" ng-bind="'SHOW_CONTRIBUTORS'|translate"></li>
                <li ng-click="hideContrib()" ng-show="showContributors && showRequirement" ng-bind="'HIDE_CONTRIBUTORS'|translate"></li>
                <li ng-click="markDone(req, 'done')" ng-show="activeUser !== null && !req.realized" ng-bind="'MARK_AS_DONE'|translate"></li>
                <li ng-click="markDone(req, null)" ng-show="activeUser !== null && req.realized" ng-bind="'MARK_AS_UNDONE'|translate"></li>
                <li ng-click="followRequirement($event,req)" ng-show="activeUser !== null" ng-bind="'FOLLOW_REQUIREMENT'|translate"></li>
                <li ng-click="developRequirement($event,req)" ng-show="activeUser !== null" ng-bind="'DEVELOP_REQUIREMENT'|translate"></li>
                <li ng-click="becomeLead($event,req)" ng-show="activeUser !== null || req.leadDeveloperId === activeUser.Id" ng-bind="'BECOME_LEAD_DEV'|translate"></li>
                <li ng-click="startEdit(req,$index)" ng-show="isDirtyReq || activeUser !== null" ng-bind="'EDIT_REQUIREMENT'|translate"></li>
                <li ng-click="confirmDelete(req)" ng-show="activeUser" ng-bind="'DELETE_REQUIREMENT'|translate"></li>
              </ul>
            </div>
          </div>
          <div ng-show="!showRequirement" ng-click="setSelectedReqId(req.id,$index)" style="padding: 8px 16px 8px 16px;cursor: pointer">
            <p class="multiline-ellipsis" ng-bind="req.description" style="color: #808080"></p>
          </div>

          <!--Requirement content-->
          <div ng-class="showRequirement ? 'req-collapse-show' : 'req-collapse-hidden'">
            <div class="flex-space-between">
              <!--Requirement text view mode-->
              <pre ng-show="!isDirtyReq" ng-bind="req.description" class="requirementDesc text-087"></pre>

              <!-- Requirement edit mode -->
              <div ng-show="isDirtyReq" style="width: 100%;" class="text-087">
                <div ng-file-drop ng-file-change="fileSelected($files,$event)" drag-over-class="dragover" allow-dir="true" accept="image/*,application/pdf,video/*">
                  <h4 ng-bind="'TITLE_AND_DESCRIPTION'|translate"></h4>
                  <paper-input ng-model="dirtyReq.title" label={{'TITLE'|translate}} maxlength="50" char-counter></paper-input>
                  <paper-textarea ng-model="dirtyReq.description" label={{'DESC'|translate}}></paper-textarea>
                </div>
                <div ng-no-file-drop>
                  <h4 ng-bind="'TITLE_AND_DESCRIPTION'|translate"></h4>
                  <paper-input ng-model="dirtyReq.title" label={{'TITLE'|translate}} maxlength="50" char-counter></paper-input>
                  <paper-textarea ng-model="dirtyReq.description" label={{'DESC'|translate}}></paper-textarea>
                </div>
                <div ng-show="isDirtyReq" class="save-req-container">
                  <paper-spinner ng-show="mainReqSavingInprogress" active alt="saving in process"></paper-spinner>
                  <paper-button raised ng-click="saveChanges()" ng-disabled="mainReqSavingInprogress" ng-bind="'SAVE_CHANGES'|translate"></paper-button>
                  <paper-button raised ng-click="cancelChanges()" ng-disabled="mainReqSavingInprogress" ng-bind="'CANCEL'|translate"></paper-button>
                  <!--<paper-icon-button ng-file-select ng-file-change="fileSelected($files)" hidden icon="icons:attachment"></paper-icon-button>-->
                </div>
              </div>

              <!--List of contributors-->
              <div id="main-contributors-container" ng-show="showContributors">
                <p ng-bind="'CREATED_BY' |translate" class="small-grey-text"></p>
                <my-user src={{trustSrc(req.creator.profileImage)}} size="30" name={{req.creator.userName}}></my-user>
                <p ng-bind="'LEADER' |translate" class="small-grey-text"></p>
                <my-user src={{trustSrc(req.leadDeveloper.profileImage)}} size="30" name={{req.leadDeveloper.userName}}></my-user>
                <p ng-bind="'FOLLOWERS' |translate" class="small-grey-text"></p>
                <my-user ng-repeat="follower in req.followers" src={{trustSrc(follower.profileImage)}} size="30" name={{follower.userName}}></my-user>
                <p ng-bind="'DEVELOPERS' |translate" class="small-grey-text"></p>
                <my-user ng-repeat="dev in req.developers" src={{trustSrc(dev.profileImage)}} size="30" name={{dev.userName}}></my-user>
              </div>
            </div>
            <!--Comments container-->
            <div ng-controller="CommentCtrl">
              <!--List of comments-->
              <h3 ng-bind="'COMMENTS' | translate" class="text-087"></h3>
              <div ng-repeat="comment in req.comments" class="comment-container">
                <img ng-src={{comment.creator.profileImage}} fallback-src="images/no-image-found.gif" height="40px" width="40px">
                <div class="width-max" class="text-087">
                  <pre style="font-size: 90%">{{comment.message}}</pre>
                  <div class="main-comment-author flex-space-between small-grey-text">
                    <p>
                      {{comment.creator.userName}}
                      <time is="relative-time" datetime={{comment.creationTime}}></time>
                    </p>
                    <span ng-click="deleteComment(comment.Id,req)" ng-hide="activeUser === null" ng-bind="'REMOVE'|translate"></span>
                  </div>
                </div>
              </div>

              <!--Create comment-->
              <paper-textarea ng-model="newComment" label={{'COMMENT_PLACEHOLDER'|translate}} ng-hide="activeUser === null" style="margin-top: 32px;"></paper-textarea>
              <paper-spinner ng-show="mainCommentSavingInprogress" active alt="saving in process"></paper-spinner>
              <paper-button raised ng-click="submitComment(newComment,req)" ng-disabled="mainCommentSavingInprogress" ng-bind="'SUBMIT'|translate" ng-show="newComment"  class="text-087"></paper-button>
            </div>
          </div>
        </paper-material>
      </div>


    </div>


    <!--

    Create a Requirement / Component

    -->
    <div ng-controller="CreateRequirementCtrl">
      <paper-fab id="addRequirementFab" icon="add" ng-click="startCreation()" title={{'CREATE_REQ'|translate}}></paper-fab>

      <!-- For mobile -->
      <paper-dialog modal id="create-dialog-requirement" class="create-dialog">
        <div>
          <p ng-bind="'CREATE_REQ' | translate"></p>
          <paper-input ng-model="name" label={{'TITLE'|translate}} maxlength="50" char-counter></paper-input>
          <paper-textarea  ng-model="desc" label={{'DESC'|translate}}></paper-textarea>

          <!--Confirm or cancel submit-->
          <div class="flex-space-between" style="flex-grow: 1; align-items: flex-end; padding-bottom: 32px;">
            <paper-button raised ng-click="submit()" ng-bind="'CREATE' | translate"></paper-button>
            <paper-button ng-click="clearSubmit()">
              <iron-icon icon="icons:clear"></iron-icon>
            </paper-button>
          </div>
        </div>
      </paper-dialog>
      <!-- For Desktop -->
      <div class="add-item-div create-container" ng-show="showCreateDiv">
        <p ng-bind="'CREATE_REQ' | translate"></p>
        <paper-input ng-model="name" label={{'TITLE'|translate}} maxlength="50" char-counter></paper-input>
        <paper-textarea  ng-model="desc" label={{'DESC'|translate}}></paper-textarea>

        <!--Confirm or cancel submit-->
        <div class="flex-space-between" style="flex-grow: 1; align-items: flex-end; padding-bottom: 32px;">
          <paper-button raised ng-click="submit()" ng-bind="'CREATE' | translate"></paper-button>
          <paper-button ng-click="clearSubmit()">
            <iron-icon icon="icons:clear"></iron-icon>
          </paper-button>
        </div>
      </div>

    </div>

    <!-- For Mobile-->
    <paper-dialog id="create-dialog-component" modal class="create-dialog">
      <div ng-controller="CreateComponentCtrl">
        <p ng-bind="'CREATE_COMP' | translate"></p>
        <paper-input ng-model="name" label={{'TITLE'|translate}} maxlength="50" char-counter></paper-input>
        <paper-textarea  ng-model="desc" label={{'DESC'|translate}}></paper-textarea>

        <!--Confirm or cancel submit-->
        <div class="flex-space-between" style="flex-grow: 1; align-items: flex-end; padding-bottom: 32px;">
          <paper-button raised ng-click="submit()" ng-bind="'CREATE' | translate"></paper-button>
          <paper-button ng-click="clearSubmit()">
            <iron-icon icon="icons:clear"></iron-icon>
          </paper-button>
        </div>
      </div>
    </paper-dialog>
    <!-- For Desktop -->
    <div ng-show="showCreateCompDiv" ng-controller="CreateComponentCtrl" class="create-container" style="right: 150px;">
      <p ng-bind="'CREATE_COMP'|translate"></p>
      <paper-input ng-model="name" label={{'TITLE'|translate}} maxlength="50" char-counter></paper-input>
      <paper-textarea  ng-model="desc" label={{'DESC'|translate}}></paper-textarea>

      <!--Confirm or cancel submit-->
      <div class="flex-space-between" style="flex-grow: 1; align-items: flex-end; padding-bottom: 32px;">
        <paper-button raised ng-click="submit()" ng-bind="'CREATE' | translate"></paper-button>
        <paper-button ng-click="clearSubmit()">
          <iron-icon icon="icons:clear"></iron-icon>
        </paper-button>
      </div>
    </div>

  </div>
</paper-drawer-panel>

<!--

      Confirmation Dialogs for projects, components and requirements

    -->
<paper-dialog id="confirmDelete" heading={{'CONFIRM_DEL'|translate}} with-backdrop style="max-width: 400px">
  <h2 ng-bind="deleteDesc|translate" style="white-space: normal;"></h2>
  <div class="buttons">
    <paper-button dialog-dismiss ng-bind="'DECLINE' | translate"></paper-button>
    <paper-button dialog-confirm ng-click="deleteComponent()" ng-show="deleteElem == 'comp'" ng-bind="'ACCEPT' | translate"></paper-button>
    <paper-button dialog-confirm ng-click="deleteRequirement()" ng-show="deleteElem == 'req'" ng-bind="'ACCEPT' | translate"></paper-button>
  </div>
</paper-dialog>
