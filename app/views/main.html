<paper-drawer-panel>

  <!-- Left hand sidebar for component selection and project settigns-->
  <div class="drawer-sidebar" drawer>

    <!-- Project name, settings -->
    <div style="display: flex;justify-content: space-between">
      <h4 ng-bind="activeProject.name" style="text-align: center;"></h4>
      <iron-icon ng-show="activeUser !== null" icon="settings" ng-click="editProject()" style="padding: 8px;margin: auto;cursor: pointer;min-width: 24px;"></iron-icon>
    </div>

    <!-- Create new component -->
    <paper-button raised ng-click="startCreationComp()" ng-show="activeUser !== null" ng-bind="'COMPONENT'|translate" class="text-087"></paper-button>

    <!-- List of components and filter -->
    <div class="group" style="padding: 8px">
      <input placeholder={{'FILTER_COMPONENTS'|translate}} type="text" ng-model="filterComp.name">
      <span class="highlight"></span>
      <span class="bar"></span>
    </div>
    <paper-button ng-repeat="component in components | filter:filterComp:strict" ng-click="selectComp(component)" ng-bind="component.name" noink class="text-087"></paper-button>
    <paper-button raised id="loadComponents" ng-show="reloadComponents" ng-click="selectProj(activeProject)" ng-bind="'RELOAD'|translate"></paper-button>
  </div>

  <!-- The main content panel -->
  <div class="drawer-main" main id="inf-scroll" infinite-scroll="addMoreItems()" infinite-scroll-distance="2">
    <div class="content">
      <!--Currently selected component-->
      <div id="current-component" class="current-component-width" ng-controller="ActiveCompCtrl">
        <paper-material elevation="1">
          <div class="flex-space-between" style="padding: 8px">
            <div class="text-087">
              <div ng-show="!isDirty">
                <span ng-show="activeProject.defaultComponentId === activeComponent.id" ng-bind="'DEFAULT'|translate" class="small-grey-text"></span>
                <h2 contenteditable="false" ng-model="activeComponent.name"></h2>
                <div contenteditable="false" ng-model="activeComponent.description"></div>
              </div>
              <div ng-show="isDirty" class="text-087">
                <h2 contenteditable="plaintext-only" ng-model="dirtyComp.name" style="margin-right: 10px"></h2>
                <p contenteditable ng-model="dirtyComp.description" style="padding: 10px;min-height: 50px;margin-right: 10px"></p>
                <paper-button raised ng-click="saveChanges()" ng-bind="'SAVE'|translate" style="margin: 0px"></paper-button>
                <paper-button raised ng-click="cancelChanges()" ng-bind="'CANCEL'|translate"  style="margin: 0px"></paper-button>
              </div>
            </div>
            <div>
              <div id="comp-lead-container">
                <p ng-bind="'COMPONENT_LEAD' |translate" class="small-grey-text"></p>
                <div class="drop" ng-show="activeUser !== null">
                  <iron-icon icon="icons:more-vert"></iron-icon>
                  <ul>
                    <li ng-click="setDefaulComp()" ng-bind="'SET_DEFAULT_COMP'|translate"></li>
                    <li ng-show="false" ng-click="" ng-bind="'BECOME_LEAD_DEV'|translate"></li>
                    <li ng-click="startEdit()" ng-disabled="isDirtyReq" ng-bind="'EDIT_COMP'|translate"></li>
                    <li ng-click="confirmDelete()" ng-bind="'DELETE_COMP'|translate"></li>
                  </ul>
                </div>
              </div>
              <my-user src={{trustSrc(componentLeader.profileImage)}} size="30" name={{componentLeader.userName}} class="text-087"></my-user>
              <div id="show-realized">
                <span>{{'REALIZED_REQ' | translate}}</span>
                <paper-toggle-button ng-model="showRealized.value"></paper-toggle-button>
              </div>
              <div class="group">
                <input placeholder={{'SEARCH_REQUIREMENTS'|translate}} type="text" ng-model="filterReq.$">
                <span class="highlight"></span>
                <span class="bar"></span>
              </div>
            </div>
          </div>
        </paper-material>
      </div>

      <!--If there is a network problem loading the requirements then this button is shown-->
      <paper-button raised id="load-requirements" ng-show="reloadRequirements" ng-click="selectComp(activeComponent)" ng-bind="'RELOAD'|translate" class="text-087"></paper-button>


      <!-- List of requirements , WARNING, don't include any css classes to this div, causes bugs -->
      <div id="req-{{$index}}" ng-repeat="req in requirements | filter:isRealizedFilter |filter:filterReq:strict |  limitTo : limit track by req.id"
           ng-controller="RequirementCtrl"
           class="requirement-container"
           ng-style="{ 'margin-bottom': $last ? '64px' : '0px' }"
           style="margin-top: 10px;background-color: white;width: 100%;margin-left: auto;margin-right: auto;max-width: 1000px;">
        <!--Requirement header-->
        <paper-material elevation="1">
          <div class="requirement-header">
            <div ng-click="setSelectedReqId(req.id,$index)" class="requirement-header-title">
              <div class="flex-space-between text-087">
                <span ng-bind="req.title" class="ellipsis req-title"></span>
              </div>
              <time is="relative-time" datetime={{req.creation_time}} class="small-grey-text"></time>
              <span class="small-grey-text"> by {{reqCreator}}</span>
            </div>
            <div ng-controller="VoteCtrl" class="vote-button-container">
              <paper-button style="min-width: 30px" ng-click="vote(req,false)">
                <iron-icon ng-show="req.userVoted === 'UP_VOTE'" icon="icons:star"></iron-icon>
                <iron-icon ng-show="req.userVoted !== 'UP_VOTE'" icon="icons:star-border"></iron-icon>
              </paper-button>
              <p ng-bind="req.upVotes" class="small-grey-text"></p>
            </div>
            <div class="drop">
              <iron-icon icon="icons:more-vert"></iron-icon>
              <ul>
                <li ng-click="showContrib(req,$index)" ng-show="!showContributors || !showRequirement" ng-bind="'SHOW_CONTRIBUTORS'|translate"></li>
                <li ng-click="hideContrib()" ng-show="showContributors && showRequirement" ng-bind="'HIDE_CONTRIBUTORS'|translate"></li>
                <li ng-click="markDone(req, 'done')" ng-show="activeUser !== null && !req.realized" ng-bind="'MARK_AS_DONE'|translate"></li>
                <li ng-click="markDone(req, null)" ng-show="activeUser !== null && req.realized" ng-bind="'MARK_AS_UNDONE'|translate"></li>
                <li ng-click="followRequirement($event,req)" ng-show="activeUser !== null" ng-bind="'FOLLOW_REQUIREMENT'|translate"></li>
                <li ng-click="developRequirement($event,req)" ng-show="activeUser !== null" ng-bind="'DEVELOP_REQUIREMENT'|translate"></li>
                <li ng-click="becomeLead($event,req)" ng-show="activeUser !== null || req.leadDeveloperId === activeUser.Id" ng-bind="'BECOME_LEAD_DEV'|translate"></li>
                <li ng-click="startEdit(req,$index)" ng-show="isDirtyReq || activeUser !== null" ng-bind="'EDIT_REQUIREMENT'|translate"></li>
                <li ng-click="confirmDelete(req)" ng-show="activeUser" ng-bind="'DELETE_REQUIREMENT'|translate"></li>
              </ul>
            </div>
          </div>
          <div ng-show="!showRequirement" ng-click="setSelectedReqId(req.id,$index)" style="padding: 8px 16px 8px 16px;cursor: pointer">
            <p class="multiline-ellipsis" ng-model="req.description" contenteditable="false" style="color: #808080"></p>
          </div>

          <!--Requirement content-->
          <div ng-show="showRequirement" class="req-collapse">
            <div class="flex-space-between">
              <!--Requirement text view mode-->
              <pre ng-show="!isDirtyReq" ng-bind="req.description" class="requirementDesc text-087"></pre>

              <!-- Requirement edit mode -->
              <div ng-show="isDirtyReq" style="width: 100%;" class="text-087">
                <div ng-file-drop ng-file-change="fileSelected($files,$event)" drag-over-class="dragover" allow-dir="true" accept="image/*,application/pdf,video/*">
                  <h4 ng-bind="'TITLE_AND_DESCRIPTION'|translate"></h4>
                  <paper-input ng-model="dirtyReq.title" label={{'TITLE'|translate}} maxlength="50" char-counter></paper-input>
                  <paper-textarea ng-model="dirtyReq.description" label={{'DESC'|translate}}></paper-textarea>
                </div>
                <div ng-no-file-drop>
                  <h4 ng-bind="'TITLE_AND_DESCRIPTION'|translate"></h4>
                  <paper-input ng-model="dirtyReq.title" label={{'TITLE'|translate}} maxlength="50" char-counter></paper-input>
                  <paper-textarea ng-model="dirtyReq.description" label={{'DESC'|translate}}></paper-textarea>
                </div>
                <div ng-show="isDirtyReq" class="save-req-container">
                  <paper-button raised ng-click="saveChanges()" ng-bind="'SAVE_CHANGES'|translate"></paper-button>
                  <paper-button raised ng-click="cancelChanges()" ng-bind="'CANCEL'|translate"></paper-button>
                  <!--<paper-icon-button ng-file-select ng-file-change="fileSelected($files)" hidden icon="icons:attachment"></paper-icon-button>-->
                </div>
              </div>

              <!--List of contributors-->
              <div id="main-contributors-container" ng-show="showContributors">
                <p ng-bind="'CREATED_BY' |translate" class="small-grey-text"></p>
                <my-user src={{trustSrc(req.creator.profileImage)}} size="30" name={{req.creator.userName}}></my-user>
                <p ng-bind="'LEADER' |translate" class="small-grey-text"></p>
                <my-user src={{trustSrc(req.leadDeveloper.profileImage)}} size="30" name={{req.leadDeveloper.userName}}></my-user>
                <p ng-bind="'FOLLOWERS' |translate" class="small-grey-text"></p>
                <my-user ng-repeat="follower in req.followers" src={{trustSrc(follower.profileImage)}} size="30" name={{follower.userName}}></my-user>
                <p ng-bind="'DEVELOPERS' |translate" class="small-grey-text"></p>
                <my-user ng-repeat="dev in req.developers" src={{trustSrc(dev.profileImage)}} size="30" name={{dev.userName}}></my-user>
              </div>
            </div>
            <!--Comments container-->
            <div ng-controller="CommentCtrl">
              <!--List of comments-->
              <h3 ng-bind="'COMMENTS' | translate" class="text-087"></h3>
              <div ng-repeat="comment in req.comments" class="comment-container">
                <img ng-src={{comment.creator.profileImage}} fallback-src="images/no-image-found.gif" height="40px" width="40px" style="flex: 0 0 auto;">
                <div class="width-max" class="text-087">
                  <pre style="font-size: 90%">{{comment.message}}</pre>
                  <div class="comment-meta-container">
                    <p class="small-grey-text width-max">
                      {{comment.creator.userName}}
                      <time is="relative-time" datetime={{comment.creationTime}}></time>
                    </p>
                    <paper-button ng-click="deleteComment(comment.Id,req)" ng-hide="activeUser === null">
                      <iron-icon icon="icons:delete"></iron-icon>
                    </paper-button>
                  </div>
                </div>
              </div>

              <!--Create comment-->
              <paper-textarea ng-model="newComment" label={{'COMMENT_PLACEHOLDER'|translate}} ng-hide="activeUser === null" style="margin-top: 32px;"></paper-textarea>
              <paper-button raised ng-click="submitComment(newComment,req);newComment='';" ng-bind="'SUBMIT'|translate" ng-show="newComment"  class="text-087"></paper-button>
            </div>
          </div>
        </paper-material>
      </div>


    </div>


    <!--

  Create a Requirement / Component / Project

  -->

    <div class="create-container">
      <!--Create a new requirement-->

      <div ng-controller="CreateRequirementCtrl" class="create-div">
        <paper-fab id="addRequirementFab" icon="add" ng-click="startCreation()" title={{'CREATE_REQ'|translate}}></paper-fab>
        <div class="add-item-div" ng-show="showCreateDiv">
          <p ng-bind="'CREATE_REQ' | translate"></p>
          <paper-input ng-model="newName" label={{'TITLE'|translate}} maxlength="50" char-counter></paper-input>
          <paper-textarea ng-model="newDesc" label={{'DESC'|translate}}></paper-textarea>

          <!--Confirm or add attachments-->
          <div class="flex-space-between">
            <paper-button raised ng-click="submitReq()" ng-bind="'CREATE' | translate"></paper-button>
            <paper-button ng-click="clearSubmit()">
              <iron-icon icon="icons:delete"></iron-icon>
            </paper-button>
          </div>
        </div>
      </div>

      <!--Create a new component-->
      <div ng-show="showCreateCompDiv" class="create-div">
        <div ng-controller="CreateComponentCtrl" class="add-item-div">
          <p ng-bind="'CREATE_COMP'|translate"></p>
          <paper-input ng-model="name" label={{'TITLE'|translate}} maxlength="50" char-counter></paper-input>
          <paper-textarea ng-model="desc" label={{'DESC'|translate}}></paper-textarea>

          <!--Confirm or cancel submit-->
          <div class="flex-space-between">
            <paper-button raised ng-click="submitComponent()" ng-bind="'CREATE' | translate"></paper-button>
            <paper-button ng-click="clearSubmit()">
              <iron-icon icon="icons:delete"></iron-icon>
            </paper-button>
          </div>
        </div>
      </div>

    </div>

  </div>
</paper-drawer-panel>

<!--

      Confirmation Dialogs for projects, components and requirements

    -->
<paper-dialog id="confirmDelete" heading={{'CONFIRM_DEL'|translate}}>
  <h2 ng-bind="deleteDesc|translate"></h2>
  <div class="buttons">
    <paper-button dialog-dismiss ng-bind="'DECLINE' | translate"></paper-button>
    <paper-button dialog-confirm ng-click="deleteComponent()" ng-show="deleteElem == 'comp'" ng-bind="'ACCEPT' | translate"></paper-button>
    <paper-button dialog-confirm ng-click="deleteRequirement()" ng-show="deleteElem == 'req'" ng-bind="'ACCEPT' | translate"></paper-button>
  </div>
</paper-dialog>
