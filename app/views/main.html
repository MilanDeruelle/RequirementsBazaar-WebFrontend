<!--The main panel of the application-->
<core-header-panel flex>

  <!--The top navigation bar-->
  <core-toolbar id="mainheader">
    <paper-icon-button id="navicon" icon="menu" ng-click="showSidebar = !showSidebar"></paper-icon-button>
    <paper-dropdown-menu label="{{activeProject.name}}" id="projectSelection">
      <paper-dropdown class="dropdown">
        <core-selector>
          <paper-item ng-repeat="project in projects" value="{{project.name}}" ng-click="selectProj(project)">{{project.name}}</paper-item>
        </core-selector>
      </paper-dropdown>
    </paper-dropdown-menu>
    <span flex></span>

    <!--Open Notifications button and div-->
    <paper-icon-button icon="social:notifications-none" ng-click="isNotificationsOpen = !isNotificationsOpen"></paper-icon-button>
    <div id="NotificationDiv" ng-show="isNotificationsOpen">
      <p>Here will be notifications</p>
    </div>

    <!--Open Profile button and div-->
    <paper-icon-button icon="social:person" ng-click="isProfileOpen = !isProfileOpen"></paper-icon-button>
    <div id="profileDiv" ng-show="isProfileOpen">
      <div id="profileDivContent" style="margin: 12px">
        <p>{{activeUser.firstname}} {{activeUser.lastname}}</p>
        <p style="color: #808080; font-size: small">{{activeUser.email}}</p>
        <p style="color: #808080; font-size: small">Is admin : {{activeUser.admin}}</p>
      </div>
      <div id="profileDivFooter">
        <paper-button ng-click="editProfile()">Edit</paper-button>
        <paper-button ng-click="signOut()">Sign Out</paper-button>
      </div>
    </div>

    <paper-button>
      <oauth
        site="https://api.learning-layers.eu/o/oauth2"
        client-id="f4635a5a-8455-4cf4-9834-6f6f16bf9aec"
        data-scope="openid email profile"
        redirect-uri="http://localhost:9000/"
        profile-uri="https://api.learning-layers.eu/o/oauth2/userinfo"
        scope="public">
      </oauth>
    </paper-button>

  </core-toolbar>

  <div id="containerMain">
    <!--The side bar of the application / component selection-->
    <div id="sidebar" ng-show="!showSidebar" style="position: absolute;width: 195px;background-color: white;z-index: 10">
      <!--Create a new component-->
      <paper-button ng-click="showCreateCompDiv=!showCreateCompDiv" style="display: block;">
        <core-icon icon="icons:add-circle" style="padding-right: 5px"></core-icon>
        Component
      </paper-button>
      <div ng-hide="!showCreateCompDiv" style="background-color: white;margin-bottom: 20px">
        <paper-input-decorator label="Name">
          <paper-autogrow-textarea>
            <textarea ng-model="newCompName"></textarea>
          </paper-autogrow-textarea>
        </paper-input-decorator>
        <paper-input-decorator label="Description">
          <paper-autogrow-textarea>
            <textarea ng-model="newCompDesc"></textarea>
          </paper-autogrow-textarea>
        </paper-input-decorator>
        <paper-icon-button ng-click="submitNewComponent()" icon="icons:check"></paper-icon-button>
        <paper-icon-button ng-click="clearComponentSubmit()" icon="icons:clear"></paper-icon-button>
      </div>
      <!--Show component list-->
      <core-menu id="componentSelection">
        <paper-item ng-repeat="component in components" ng-click="selectComp(component)">{{component.name}}</paper-item>
      </core-menu>
    </div>


    <!--The main content panel-->
    <div class="content">
      <!--Currently selected component-->
      <div id="currentComponent" class="section group">
        <div class="col span_6_of_8">
          <h2 ng-bind="activeComponent.name"></h2>
          <p ng-bind="activeComponent.description"></p>
        </div>
        <div class="col span_2_of_8">
          <p style="font-size: small">Component lead:</p>
          <p>
            <span ng-bind="componentLeader.firstName"></span>
            <span ng-bind="componentLeader.lastName"></span>
          </p>
          <paper-icon-button icon="editor:mode-edit"></paper-icon-button>
          <paper-icon-button icon="icons:delete" ng-click="initDeleteComponent()"></paper-icon-button>
        </div>
      </div>

      <!--List representing the requirements-->
      <div ng-repeat="req in requirements">
        <div style="background-color: white" class="section group">
          <paper-item ng-class="{ 'span_4_of_8': $index == selectedIndex, 'col':true, 'span_7_of_8': $index !== selectedIndex}" style="background: white; font-size: large;padding: 0px" ng-click="toggleRequirement($event,req)">{{req.title}}</paper-item>
          <div ng-class="{ 'span_4_of_8': $index == selectedIndex, 'col':true, 'span_1_of_8': $index !== selectedIndex}" style="display: flex;flex-direction: row-reverse;">
            <paper-icon-button icon="icons:more-vert" ng-click="showMoreClicked($index)"></paper-icon-button>
            <div ng-hide="!($index == selectedIndex)" style="display: flex;flex-wrap: wrap;">
              <paper-button style="margin: 6px;">Become Lead</paper-button>
              <paper-icon-button icon="mdi:eye" ng-click="followRequirement($event,req)"></paper-icon-button>
              <paper-icon-button icon="editor:mode-edit"></paper-icon-button>
              <paper-icon-button icon="icons:thumb-up"></paper-icon-button>
              <paper-icon-button icon="icons:thumb-down"></paper-icon-button>
              <paper-icon-button icon="icons:delete"></paper-icon-button>
            </div>
          </div>
        </div>
        <core-collapse data-visible = 'false'>
          <!--Space for description, comments and attachments-->
          <div class="collapse-content section group">
            <div class="col span_6_of_8">
              <p>{{req.description}}</p>
            </div>

            <!--Sidebar for the individal requirements-->
            <div class="col span_2_of_8">
              <p style="font-weight: bold">Leader</p>
              <p style="padding-left: 8px">{{req.leadDeveloper.firstName}} {{req.leadDeveloper.lastName}}</p>
              <div>
                <p style="font-weight: bold">Followers</p>
                <p ng-repeat="follower in req.followers" style="padding-left: 8px">
                  {{follower.firstName}}
                </p>
              </div>
              <div>
                <p style="font-weight: bold">Developers </p>
                <p ng-repeat="dev in req.developers" style="padding-left: 8px">
                  {{dev.firstName}}
                </p>
              </div>
              <p style="font-weight: bold">Created by</p>
              <p style="padding-left: 8px">{{req.creator.firstName}} {{req.creator.lastName}}</p>
            </div>
          </div>
        </core-collapse>
        </br>
      </div>

    </div>
  </div>

  <!--Pop-up elements-->
  <paper-action-dialog id="deleteSomething" heading="Dialog Title" transition="core-transition-center" ng-show="warningVisible">
    <paper-shadow z="1">
      <p>{{warningText}}</p>
      <paper-button affirmative ng-click="resetDeleteComponent()">Decline</paper-button>
      <paper-button affirmative ng-click="deleteComponent()">Accept</paper-button>
    </paper-shadow>
  </paper-action-dialog>

  <paper-fab id="addRequirementFab" icon="icons:add" ng-click="showCreateReqDiv = !showCreateReqDiv"></paper-fab>
  <div id="addRequirementDiv" ng-hide="!showCreateReqDiv">
    <p>Add requirement</p>
    <paper-input-decorator label="Name">
      <paper-autogrow-textarea>
        <textarea ng-model="newReqName"></textarea>
      </paper-autogrow-textarea>
    </paper-input-decorator>
    <paper-input-decorator label="Description">
      <paper-autogrow-textarea>
        <textarea ng-model="newReqDesc"></textarea>
      </paper-autogrow-textarea>
    </paper-input-decorator>
    <paper-icon-button ng-click="submitNewReq()" icon="icons:check"></paper-icon-button>
    <paper-icon-button ng-click="clearReqSubmit()" icon="icons:clear"></paper-icon-button>
  </div>


</core-header-panel>
